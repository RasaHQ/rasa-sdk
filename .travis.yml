language: python
sudo: required
cache:
  directories:
  - "$HOME/.cache/pip"
python:
  - '3.6'
  - '3.7'
before_install:
- pip install poetry==1.0.3
install:
- poetry install
script:
- travis_wait py.test tests --cov rasa_sdk -v
after_success:
- poetry run coveralls
jobs:
  include:
  - stage: test
    name: "Code Formatting"
    python: 3.6
    script:
      - make lint
  - stage: test
    name: "Type Check"
    python: 3.6
    script:
    - make types
  - stage: deploy
    python: 3.6
    install: skip
    script: skip
    env:
    - PYPI_USER=amn41
    - secure: "<encrypted PYPI_PASSWORD=password>"
    before_deploy:
    - poetry config http-basic.pypi $PYPI_USER $PYPI_PASSWORD
    - poetry build
    deploy:
      provider: script
      script: poetry publish
      on:
        branch: master
        tags: true
    after_deploy: ./scripts/ping_slack_about_package_release.sh
